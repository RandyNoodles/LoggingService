{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
        "server_settings":{
            "type": "object",
            "properties": {
                "ip": {"type": "string", "format": "ipv4"},
                "port": {"type": "integer", "minimum": 1, "maximum": 65535}
            }
        },
        "logfile_settings": {
            "type": "object",
            "properties": {
                "path_type": { "type": "string", "enum": ["relative", "absolute"] },
                "path": { "type": "string" },
                "format": { "type": "string", "enum": ["JSON", "plaintext"] },
                "plaintext_field_delimiter": {"type": "string", "maxLength": 1},
                "plaintext_entry_delimiter": {"type": "string"},
                "max_size_kb": { "type": "integer", "minimum": 5000, "maximum": 65536 },
                "rotation_minutes": { "type": "integer", "minimum": 0 },
                "column_order": {"type": "array", "minItems": 3, "maxItems": 30}
            },
            "required": ["path_type", "path", "format","plaintext_field_delimiter","plaintext_entry_delimiter", "max_size_kb", "rotation_minutes", "column_order"]
        },
        "protocol_settings": {
            "type": "object",
            "properties": {
                "incoming_json_schema": {"type":"string"},
                "messages_per_ip_per_minute": {"type": "integer", "minimum": 1},
                "messages_per_source_id_per_minute": {"type": "integer", "minimum": 1},
                "bad_message_blacklist_threshold": { "type": "integer", "minimum": 1 },
                "blacklisted_ips": { "type": "array", "items": { "type": "string", "format": "ipv4" } },
                "blacklisted_source_ids": {"type": "array", "items": {"type": "string"}},
                "blacklist_permanent": { "type": "boolean" },
                "blacklist_duration_seconds": { "type": "integer", "minimum": 1 }
            },
            "required": ["incoming_json_schema", "messages_per_ip_per_minute", "messages_per_source_id_per_minute", "bad_message_blacklist_threshold", "blacklist_permanent", "blacklist_duration_minutes"]
        },
        "log_format_settings": {
            "type": "object",
            "properties": {
                "supported_formats": { "type": "array", "items": { "type": "string", "enum": ["JSON", "Syslog"] } },
                "default_format": { "type": "string", "enum": ["JSON", "Syslog"] }
            },
            "required": ["supported_formats", "default_format"]
        },
        "error_handling": {
            "type": "object",
            "properties": {
                "missing_required_field": { "type": "string", "enum": ["redirect_to_error_log", "ignore", "reject"] },
                "extra_field": { "type": "string", "enum": ["truncate", "reject"] },
                "invalid_message": { "type": "string", "enum": ["redirect_to_error_log", "ignore", "reject"] },
                "error_log_path": { "type": "string" }
            },
            "required": ["missing_required_field", "extra_field", "invalid_message", "error_log_path"]
        },
        "required_field_settings":{
            "type": "object",
            "properties": {
                "timestamp_format": {"type": "string", "enum": ["ANSIC", "UnixDate", "RubyDate", "RFC822", "RFC822Z", "RFC850", "RFC1123", "RFC1123Z", "RFC3339", "RFC3339Nano", "Kitchen"]},
                "timestamp_include_in_logs": {"type": "boolean"},
                "source_ip_include_in_logs": {"type": "boolean"}
            },
            "required": [ "timestamp_format","timestamp_include_in_logs", "source_ip_include_in_logs"]
        }
    },
    "required": ["logfile_settings", "protocol_settings", "error_handling"]
}